<!--
=========================================================
* Material Dashboard 2 - v3.0.4
=========================================================

* Product Page: https://www.creative-tim.com/product/material-dashboard
* Copyright 2022 Creative Tim (https://www.creative-tim.com)
* Licensed under MIT (https://www.creative-tim.com/license)

* Coded by Creative Tim

=========================================================

* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
-->

<!-- Version: 3.0 -->
<!-- Description: 마이페이지

-------------------------------------------------------------------------------
	Date			 Author							Note
-------------------------------------------------------------------------------
2022. 8. 5.	    	noranbear				   First Creation 

2022. 8. 9.                                    복약알람탭 구현 완료

                                               처방내역탭 구현 완료
			  							 
-------------------------------------------------------------------------------
-->

<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<meta charset="UTF-8">
<title>마이페이지</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<script>
/**
 * AJAX로 받은 JSON 처방내역 데이터를 화면에 출력
 */
function displayPl(plists) {
	var html = "";
	
	// 제목
	html += "<div class='card-header pb-0 p-3'><h6 class='mb-0'>복용중</h6></div>";

	// 틀
	html += "<div class='card-body p-3'>";
	html += "<ul class='list-group'>";
	
	// 데이터 출력 부분
	for(let i = 0; i< plists.length; i++) {
		var pid = plists[i].id;				// 처방전 아이디
		var hosp = plists[i].hospital;		// 병원명
		var pdate = plists[i].pdate;		// 조제일자
		var dtime = plists[i].dtime;		// 투약시간
		var enddate = plists[i].enddate;	// 복용마침일
		
		html += "<li class='list-group-item border-0 d-flex align-items-center px-0 mb-2 pt-0'>";
		html += "<div class='avatar me-3'>";
		html += "<img src='../img/prescript-icon.png' alt='처방전 아이콘' class='border-radius-lg shadow'></div>";
		html += "<div class='d-flex align-items-start flex-column justify-content-center'>";
		html += "<a class='mb-0 text-sm' style='font-weight: 600;' href='/pdetail?id="+ pid +"'>"+ hosp +"</a>";
		html += "<p class='mb-0 text-xs'>"+ pdate + " ~ " + enddate +"</p></div>";
		html += "<a class='btn btn-link pe-3 ps-0 mb-0 ms-auto w-25 w-md-auto' style='cursor:default;'>"+ dtime +"</a></li>";
		
	}

	// 틀 close
	html += "</ul></div>";
	
	// 2. 생성된 리스트 출력
	$('#tabdiv').html(html);

}

/**
 * AJAX로 받은 JSON 알람 데이터를 화면에 출력
 */
function displayAl(alarms) {
	var html = "";
	
	// 제목
	html += "<div class='card-header pb-0 p-3'>";
	html += "<h6 class='mb-0'>오늘의 알람</h6>";
	html +=	"</div>";
	
	// 틀
	html += "<div class='card-body p-3'>";
	html += "<ul class='list-group'>";
	
	// 데이터 출력 부분
	for(let i = 0; i< alarms.length; i++) {
		var mad = alarms[i].mad;		// 아침,점심,저녁
		var time = alarms[i].time;
		var button = alarms[i].button;	// 버튼 상태
		var pid = alarms[i].pid;		// 해당 처방전페이지로 보내기 위해 필요한 처방전 아이디
		var phos = alarms[i].phos;		// 처방병원
		var color = "danger";
		var complete = "미완료";
		
		// 버튼 상태에 따른 디자인 바꾸기
		if(button == "done"){
			color = "success";
			complete = "완료";
		}
		
		html += "<li class='list-group-item border-0 d-flex align-items-center px-0 mb-2 pt-0'>";
		html += "<div class='avatar me-3'>";
		html += "<button class='btn btn-icon-only btn-rounded btn-outline-"+ color +" mb-0 me-3 p-3 btn-sm d-flex align-items-center justify-content-center' disabled>";
		html += "<i class='material-icons text-lg'>access_alarm</i>";
		
		html += "</button></div>";
		
		html += "<div class='d-flex align-items-start flex-column justify-content-center'>";
		html += "<a href='/pdetail?id="+ pid +"' class='mb-0 text-sm' style='font-weight: 600;'>"+ phos + ": " + mad +"</a>";
		html += "<p class='mb-0 text-xs'>"+ time +"</p></div>";
		html += "<p class='btn btn-link pe-3 ps-0 mb-0 ms-auto w-25 w-md-auto' style='cursor:default;'>"+ complete +"</p>";
		
		html += "</li>";
	}

    // 틀 close
	html += "</ul></div>";
	
	// 2. 생성된 리스트 출력
	$('#tabdiv').html(html);
}

/**
 * AJAX로 알람 데이터를 반환
 */
function getAlarm() {
	
	$.ajax({
		method: 'POST',
		url:'/get5alarms',
		success:function(data){
			displayAl(data);
		},
		error: function(error) {
			alert("error");
		}
		
	});
}


$(document).ready(function(){
	//getAlarm();
	
	// 복약알람 탭이 눌렸을 때
	$('#getalarm').click(function(){
		$('#tabdiv').empty();	// 기존에 있던 데이터 삭제
		
		// 알람 가져오기
		getAlarm();
	});
	
	// 처방내역 탭이 눌렸을 때
	$('#getplist').click(function(){
		$('#tabdiv').empty();
		
		$.ajax({
			method: 'POST',
			url:'/get5plists',
			success:function(data){
				displayPl(data);
			},
			error: function(error) {
				alert("error");
			}
			
		});
	});
	
});
</script>

<!-- 마이페이지 메인 화면 시작 -->
<div class="container-fluid px-2 px-md-4">
  <div class="page-header min-height-300 border-radius-xl mt-4" style="background-image: url('https://images.unsplash.com/photo-1531512073830-ba890ca4eba2?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=1920&q=80');">
    <span class="mask  bg-gradient-primary  opacity-6"></span>
  </div>
  <div class="card card-body mx-3 mx-md-4 mt-n6">
  	<!-- 1. 맨 윗 부분 시작 -->
    <div class="row gx-4 mb-2">
      <div class="col-auto">
        <div class="avatar avatar-xl position-relative">
          <img th:src="'../../img/'+${session.signinusers.photo}" alt="profile_image" class="w-100 border-radius-lg shadow-sm">
        </div>
      </div>
      <div class="col-auto my-auto">
        <div class="h-100">
          <h5 class="mb-1" th:text="${session.signinusers.name} + ' 님,'">김윤박 님,</h5>
          <p class="mb-0 font-weight-normal text-sm">회원</p>
        </div>
      </div>
      <!-- 오른쪽 nav bar 시작 -->
      <div class="col-lg-4 col-md-6 my-sm-auto ms-sm-auto me-sm-0 mx-auto mt-3">
        <div class="nav-wrapper position-relative end-0">
          <ul class="nav nav-pills nav-fill p-1" role="tablist">
            <li class="nav-item">
              <a id="getalarm" class="nav-link mb-0 px-0 py-1 active" data-bs-toggle="tab" role="tab" aria-selected="true">
                <i class="fas fa-bell text-md position-relative"></i>
                <span class="ms-1">복약알람</span>
              </a>
            </li>
            <li class="nav-item">
              <a id="getplist" class="nav-link mb-0 px-0 py-1" data-bs-toggle="tab" role="tab" aria-selected="false">
                <i class="fas fa-file-medical text-md position-relative"></i>
                <span class="ms-1">처방내역</span>
              </a>
            </li>
            <li class="nav-item">
              <a id="getmedi" class="nav-link mb-0 px-0 py-1" data-bs-toggle="tab" role="tab" aria-selected="false">
                <i class="fas fa-first-aid text-md position-relative"></i>
                <span class="ms-1">약 보관함</span>
              </a>
            </li>
          </ul>
        </div>
      </div>
      <!-- 오른쪽 nav bar 끝 -->
    </div>
    <!-- 1. 맨 윗 부분 끝 -->
    
    <div class="row">
      <div class="row">
      	<!-- 2. 플랫폼 세팅 시작 -->
        <div class="col-12 col-xl-4">
          <div class="card card-plain h-100">
            <div class="card-header pb-0 p-3">
              <h6 class="mb-0">플랫폼 설정</h6>
            </div>
            <div class="card-body p-3">
              <h6 class="text-uppercase text-body text-xs font-weight-bolder">계정</h6>
              <ul class="list-group">
                <li class="list-group-item border-0 px-0">
                  <div class="form-check form-switch ps-0">
                    <input class="form-check-input ms-auto" type="checkbox" id="flexSwitchCheckDefault" checked>
                    <label class="form-check-label text-body ms-3 text-truncate w-80 mb-0" 
                    	for="flexSwitchCheckDefault">복약 알람 받기</label>
                  </div>
                </li>
                <li class="list-group-item border-0 px-0">
                  <div class="form-check form-switch ps-0">
                    <input class="form-check-input ms-auto" type="checkbox" id="flexSwitchCheckDefault1">
                    <label class="form-check-label text-body ms-3 text-truncate w-80 mb-0" 
                    	for="flexSwitchCheckDefault1">Email me when someone answers on my post</label>
                  </div>
                </li>
                <li class="list-group-item border-0 px-0">
                  <div class="form-check form-switch ps-0">
                    <input class="form-check-input ms-auto" type="checkbox" id="flexSwitchCheckDefault2" checked>
                    <label class="form-check-label text-body ms-3 text-truncate w-80 mb-0" for="flexSwitchCheckDefault2">Email me when someone mentions me</label>
                  </div>
                </li>
              </ul>
              <h6 class="text-uppercase text-body text-xs font-weight-bolder mt-4">서비스</h6>
              <ul class="list-group">
                <li class="list-group-item border-0 px-0">
                  <div class="form-check form-switch ps-0">
                    <input class="form-check-input ms-auto" type="checkbox" id="flexSwitchCheckDefault3">
                    <label class="form-check-label text-body ms-3 text-truncate w-80 mb-0" 
                    	for="flexSwitchCheckDefault3">이메일로 정보 받기</label>
                  </div>
                </li>
                <li class="list-group-item border-0 px-0">
                  <div class="form-check form-switch ps-0">
                    <input class="form-check-input ms-auto" type="checkbox" id="flexSwitchCheckDefault4" checked>
                    <label class="form-check-label text-body ms-3 text-truncate w-80 mb-0" for="flexSwitchCheckDefault4">Monthly product updates</label>
                  </div>
                </li>
                <li class="list-group-item border-0 px-0 pb-0">
                  <div class="form-check form-switch ps-0">
                    <input class="form-check-input ms-auto" type="checkbox" id="flexSwitchCheckDefault5">
                    <label class="form-check-label text-body ms-3 text-truncate w-80 mb-0" for="flexSwitchCheckDefault5">Subscribe to newsletter</label>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </div>
        <!-- 2. 플랫폼 세팅 끝 -->
        <!-- 3. 회원정보 시작 -->
        <div class="col-12 col-xl-4">
          <div class="card card-plain h-100">
            <div class="card-header pb-0 p-3">
              <div class="row">
                <div class="col-md-8 d-flex align-items-center">
                  <h6 class="mb-0">회원 정보</h6>
                </div>
                <div class="col-md-4 text-end">
                  <a th:href="@{/mypage/profile}">
                    <i class="fas fa-user-edit text-secondary text-sm" data-bs-toggle="tooltip" data-bs-placement="top" 
                    title="프로필 수정"></i>
                  </a>
                </div>
              </div>
            </div>
            <!-- 회원정보 들어가는 곳 시작-->
            <div class="card-body p-3">
              <ul class="list-group">
                <li class="list-group-item border-0 ps-0"><strong class="text-dark">아이디:</strong>
                	<span class="text-sm" th:text="'&nbsp;' + ${session.signinusers.id}"></span>
                </li>
                <li class="list-group-item border-0 ps-0"><strong class="text-dark">비밀번호:</strong>
                	<a class="text-sm" href="#">&nbsp;비밀번호 확인</a>
                </li>
                <li class="list-group-item border-0 ps-0"><strong class="text-dark">이메일:</strong>
                	<span class="text-sm" th:text="'&nbsp;' + ${session.signinusers.email}"></span>
                </li>
                <li class="list-group-item border-0 ps-0"><strong class="text-dark">생년월일:</strong>
                	<span class="text-sm" th:text="'&nbsp;' + ${session.signinusers.birth}"></span>
                </li>
                <li class="list-group-item border-0 ps-0"><strong class="text-dark">성별:</strong>
                	<span class="text-sm" th:text="'&nbsp;' + ${session.signinusers.sex}"></span>
                </li>
                <li class="list-group-item border-0 ps-0"><strong class="text-dark">가입일자:</strong>
                	<span class="text-sm" th:text="'&nbsp;' + ${#dates.format(session.signinusers.regdate,'yyyy-MM-dd')}"></span>
                </li>  
              </ul>
            </div>
            <!-- 회원정보 들어가는 곳 끝 -->
          </div>
        </div>
        <!-- 3. 회원정보 끝 -->
        
        <!-- 4. 오른쪽 Nav bar 안에 들어가는 정보 시작 -->
		<div class="col-12 col-xl-4">
			<div id="tabdiv" class="card card-plain h-100">
				<!-- 바뀌기 시작하는 부분 -->
			</div>
        </div>
        <!-- 4. 오른쪽 Nav bar 안에 들어가는 정보 끝 -->
        
        <!-- 5. 뭘 넣어야 할지 정해야 함 -->
        <div class="col-12 mt-4">
          <div class="mb-5 ps-3">
            <h6 class="mb-1">Projects</h6>
            <p class="text-sm">Architects design houses</p>
          </div>
          <div class="row">
            <div class="col-xl-3 col-md-6 mb-xl-0 mb-4">
              <div class="card card-blog card-plain">
                <div class="card-header p-0 mt-n4 mx-3">
                  <a class="d-block shadow-xl border-radius-xl">
                    <img src="../assets/img/home-decor-1.jpg" alt="img-blur-shadow" class="img-fluid shadow border-radius-xl">
                  </a>
                </div>
                <div class="card-body p-3">
                  <p class="mb-0 text-sm">Project #2</p>
                  <a href="javascript:;">
                    <h5>
                      Modern
                    </h5>
                  </a>
                  <p class="mb-4 text-sm">
                    As Uber works through a huge amount of internal management turmoil.
                  </p>
                  <div class="d-flex align-items-center justify-content-between">
                    <button type="button" class="btn btn-outline-primary btn-sm mb-0">View Project</button>
                    <div class="avatar-group mt-2">
                      <a href="javascript:;" class="avatar avatar-xs rounded-circle" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Elena Morison">
                        <img alt="Image placeholder" src="../assets/img/team-1.jpg">
                      </a>
                      <a href="javascript:;" class="avatar avatar-xs rounded-circle" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Ryan Milly">
                        <img alt="Image placeholder" src="../assets/img/team-2.jpg">
                      </a>
                      <a href="javascript:;" class="avatar avatar-xs rounded-circle" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Nick Daniel">
                        <img alt="Image placeholder" src="../assets/img/team-3.jpg">
                      </a>
                      <a href="javascript:;" class="avatar avatar-xs rounded-circle" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Peterson">
                        <img alt="Image placeholder" src="../assets/img/team-4.jpg">
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-xl-0 mb-4">
              <div class="card card-blog card-plain">
                <div class="card-header p-0 mt-n4 mx-3">
                  <a class="d-block shadow-xl border-radius-xl">
                    <img src="../assets/img/home-decor-2.jpg" alt="img-blur-shadow" class="img-fluid shadow border-radius-lg">
                  </a>
                </div>
                <div class="card-body p-3">
                  <p class="mb-0 text-sm">Project #1</p>
                  <a href="javascript:;">
                    <h5>
                      Scandinavian
                    </h5>
                  </a>
                  <p class="mb-4 text-sm">
                    Music is something that every person has his or her own specific opinion about.
                  </p>
                  <div class="d-flex align-items-center justify-content-between">
                    <button type="button" class="btn btn-outline-primary btn-sm mb-0">View Project</button>
                    <div class="avatar-group mt-2">
                      <a href="javascript:;" class="avatar avatar-xs rounded-circle" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Nick Daniel">
                        <img alt="Image placeholder" src="../assets/img/team-3.jpg">
                      </a>
                      <a href="javascript:;" class="avatar avatar-xs rounded-circle" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Peterson">
                        <img alt="Image placeholder" src="../assets/img/team-4.jpg">
                      </a>
                      <a href="javascript:;" class="avatar avatar-xs rounded-circle" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Elena Morison">
                        <img alt="Image placeholder" src="../assets/img/team-1.jpg">
                      </a>
                      <a href="javascript:;" class="avatar avatar-xs rounded-circle" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Ryan Milly">
                        <img alt="Image placeholder" src="../assets/img/team-2.jpg">
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-xl-0 mb-4">
              <div class="card card-blog card-plain">
                <div class="card-header p-0 mt-n4 mx-3">
                  <a class="d-block shadow-xl border-radius-xl">
                    <img src="../assets/img/home-decor-3.jpg" alt="img-blur-shadow" class="img-fluid shadow border-radius-xl">
                  </a>
                </div>
                <div class="card-body p-3">
                  <p class="mb-0 text-sm">Project #3</p>
                  <a href="javascript:;">
                    <h5>
                      Minimalist
                    </h5>
                  </a>
                  <p class="mb-4 text-sm">
                    Different people have different taste, and various types of music.
                  </p>
                  <div class="d-flex align-items-center justify-content-between">
                    <button type="button" class="btn btn-outline-primary btn-sm mb-0">View Project</button>
                    <div class="avatar-group mt-2">
                      <a href="javascript:;" class="avatar avatar-xs rounded-circle" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Peterson">
                        <img alt="Image placeholder" src="../assets/img/team-4.jpg">
                      </a>
                      <a href="javascript:;" class="avatar avatar-xs rounded-circle" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Nick Daniel">
                        <img alt="Image placeholder" src="../assets/img/team-3.jpg">
                      </a>
                      <a href="javascript:;" class="avatar avatar-xs rounded-circle" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Ryan Milly">
                        <img alt="Image placeholder" src="../assets/img/team-2.jpg">
                      </a>
                      <a href="javascript:;" class="avatar avatar-xs rounded-circle" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Elena Morison">
                        <img alt="Image placeholder" src="../assets/img/team-1.jpg">
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-xl-0 mb-4">
              <div class="card card-blog card-plain">
                <div class="card-header p-0 mt-n4 mx-3">
                  <a class="d-block shadow-xl border-radius-xl">
                    <img src="https://images.unsplash.com/photo-1606744824163-985d376605aa?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80" alt="img-blur-shadow" class="img-fluid shadow border-radius-xl">
                  </a>
                </div>
                <div class="card-body p-3">
                  <p class="mb-0 text-sm">Project #4</p>
                  <a href="javascript:;">
                    <h5>
                      Gothic
                    </h5>
                  </a>
                  <p class="mb-4 text-sm">
                    Why would anyone pick blue over pink? Pink is obviously a better color.
                  </p>
                  <div class="d-flex align-items-center justify-content-between">
                    <button type="button" class="btn btn-outline-primary btn-sm mb-0">View Project</button>
                    <div class="avatar-group mt-2">
                      <a href="javascript:;" class="avatar avatar-xs rounded-circle" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Peterson">
                        <img alt="Image placeholder" src="../assets/img/team-4.jpg">
                      </a>
                      <a href="javascript:;" class="avatar avatar-xs rounded-circle" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Nick Daniel">
                        <img alt="Image placeholder" src="../assets/img/team-3.jpg">
                      </a>
                      <a href="javascript:;" class="avatar avatar-xs rounded-circle" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Ryan Milly">
                        <img alt="Image placeholder" src="../assets/img/team-2.jpg">
                      </a>
                      <a href="javascript:;" class="avatar avatar-xs rounded-circle" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Elena Morison">
                        <img alt="Image placeholder" src="../assets/img/team-1.jpg">
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- 5. 뭘 넣어야 할지 정해야 함 끝 -->
      </div>
    </div>
  </div>
</div>
<!-- 마이페이지 메인 화면 끝 -->
